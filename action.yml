name: "OpenAF's setup action"
description: "Setups OpenAF to be use in a GitHub action"
branding:
  icon : 'command'
  color: 'black'
inputs:
  dist:
    description: 'The OpenAF distribution to use'
    required: false
runs:
  using: "composite"
  steps:
  # -------------------
  - name: Setup Java 21
    uses: actions/setup-java@v4
    with:
      java-version: 21
      distribution: 'temurin'
  - shell: bash
    name : Check for OpenAF runtime
    run  : |
      if [ ! -f /tmp/oaf/oaf ]; then
        CDIR=`pwd`
        mkdir /tmp/oaf
        cd /tmp/oaf
        curl https://openaf.io/${{ inputs.dist }}/openaf.jar.repacked -o openaf.jar
        java -jar openaf.jar --install
        cd $CDIR
      fi
      sudo ln -s /tmp/oaf/oaf /usr/bin/oaf
      sudo ln -s /tmp/oaf/oaf-sb /usr/bin/oaf-sb
      sudo ln -s /tmp/oaf/oafp /usr/bin/oafp
      sudo ln -s /tmp/oaf/oafp-sb /usr/bin/oafp-sb
      sudo ln -s /tmp/oaf/ojob /usr/bin/ojob
      sudo ln -s /tmp/oaf/ojob-sb /usr/bin/ojob-sb
      sudo ln -s /tmp/oaf/opack /usr/bin/opack
      sudo ln -s /tmp/oaf/openaf /usr/bin/openaf
      sudo ln -s /tmp/oaf/openaf-sb /usr/bin/openaf-sb